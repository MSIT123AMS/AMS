@model IEnumerable<AMS.Models.LeaveIndexViewModel>

<label class=" control-label" style="font-size:35px;margin:10px">請假報表</label>
    <div class="page-inner">
        <div class="card">
            <div class="card-head-row">
                <p>
                    @Html.ActionLink("請假申請", "Create", "Create", new { @class = "btn btn-outline-primary" })
                </p>
            </div>

            <div class="card-header row form-group">
                <label class=" control-label" style="font-size:20px;margin-left:20px">開始時間:</label>
                <div class="col-sm-2">
                    <input id="StartTime" name="StartTime" type="date" class="form-control" />
                </div>
                <label class=" control-label" style="font-size:20px;margin-left:20px">結束時間:</label>
                <div id="ddlemp" class="col-sm-2">
                    <input id="EndTime" name="EndTime" type="date" class="form-control" />
                </div>
                <div class="col-sm-2">
                    <button id="Search" name="Search" class="form-control">搜尋</button>

                </div>
            </div>


            <div class="card-body">
                <div class="table-responsive" id="LeaveTable">
                    @Html.Partial("_LeaveIndexPartialView", Model)

                </div>
            </div>
        </div>
    </div>


    @section scripts
{

        <script>
        $(document).ready(function () {
            $('#basic-datatables').DataTable({
            });
            $("#basic-datatables_filter").hide();
            $('#Search').bind("click",
                function () {

                    Lrsearch();
                });


            d = new Date();
            $("#StartTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() -7 ));
            $("#EndTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()+1));
        });

        function Lrsearch() {
            let a = $("#StartTime").val()
            let st = a.split('-')
            let Start = st[0] + st[1] + st[2]
            let et = $("#EndTime").val().split('-')
            let End = et[0] + et[1] + et[2]
            $.ajax({

                type: "GET",
                url: "@Url.RouteUrl("Default1", new { controller = "LeaveRequests", action = "LeaveTable" })/" + Start + "/" + End,
                }).done(function (result) {
                    $("#LeaveTable").html(result);
                    $('#basic-datatables').DataTable({
                    });
                    $("#basic-datatables_filter").hide();
                }).fail(function(e){
                alert(e.responseText);
                });
        }
        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }

        $("#StartTime").bind("change", function () {
            if ($("#StartTime").val() > $("#EndTime").val()) {
                timechange();
                $("#StartTime").val($("#EndTime").val());
            }

        });



        function timechange() {
            swal("起始時間不可大於最後時間!", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

        $("#EndTime").bind("change", function () {
            if ($("#EndTime").val() < $("#StartTime").val()) {
                timechange();
                $("#EndTime").val($("#StartTime").val());
            }

        });







        </script>
    }
