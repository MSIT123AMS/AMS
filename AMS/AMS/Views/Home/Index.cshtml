

@{
    ViewBag.Title = "Index";
}

@section styles{
    <style>
        #calendar {
            /*font-size: 30px;*/
        }
    </style>

}

<!-- Sidebar -->
<div class="sidebar sidebar-style-2">
    <div class="sidebar-wrapper scrollbar scrollbar-inner" style="font-family:'Microsoft JhengHei'">
        <div class="sidebar-content">
            <div class="user">
                <div class="avatar-sm float-left mr-2">
                    <img src="~/assets/img/woman.jpg" alt="..." class="avatar-img rounded-circle">
                </div>
                <div class="info">
                    <a data-toggle="collapse" href="#collapseExample" aria-expanded="true">
                        <span style="font-family:'Microsoft JhengHei'">
                            謝惠婷
                            @*<span class="user-level">@User.Identity.GetUserName()</span>*@

                            <span class="caret"></span>
                        </span>
                    </a>
                    <div class="clearfix"></div>

                    <div class="collapse in" id="collapseExample">
                        <ul class="nav">
                            <li>
                                <a href="#profile">
                                    <span class="link-collapse">My Profile</span>
                                </a>
                            </li>
                            <li>
                                <a href="#edit">
                                    <span class="link-collapse">Edit Profile</span>
                                </a>
                            </li>
                            <li>
                                <a href="#settings">
                                    <span class="link-collapse">Settings</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <ul class="nav nav-primary">

                <li class="nav-section">
                    <span class="sidebar-mini-icon">
                        <i class="fa fa-ellipsis-h"></i>
                    </span>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#base">
                        <i class="fa fa-search search-icon"></i>
                        <p style="font-family:'Microsoft JhengHei'">查詢</p>
                        <span class="caret"></span>
                    </a>
                    <div class="collapse" id="base">
                        <ul class="nav nav-collapse" style="font-family:'Microsoft JhengHei'">
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">
                                        個人出勤明細查詢
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="funSerchAttendancest()" )>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人刷卡明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="funLeaveIndex()" )>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人差假明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="OverTimeIndex()">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人加班明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">打卡申覆統計表</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人差勤統計查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人月勤惰統計</span>
                                </a>
                            </li>

                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#sidebarLayout2">
                        <i class="fas fa-th-list"></i>
                        <p style="font-family:'Microsoft JhengHei'">主管區</p>
                        <span class="caret"></span>
                    </a>
                    <div class="collapse" id="sidebarLayout2">
                        <ul class="nav nav-collapse">
                            <li>
                                <a href="#" onclick="funReview()">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">審核</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#sidebarLayouts1">
                        <i class="fas fa-users"></i>
                        <p style="font-family:'Microsoft JhengHei'">人資區</p>
                        <span class="caret"></span>
                    </a>
                    <div class="collapse" id="sidebarLayouts1">
                        <ul class="nav nav-collapse">
                            <li>
                                <a href="#" onclick="funEmpM()">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">員工管理</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">

                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">
                                        部門管理
                                    </span>
                                </a>
                            </li>

                            <li>
                                <a href="#" onclick="funSerchAds()" )>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">刷卡明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="funSerchLev()" )>

                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">差假明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="funSerchOvt()" )>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">加班明細查詢</span>
                                </a>
                            </li>


                        </ul>
                    </div>
                </li>



            </ul>
        </div>
    </div>
</div>

<!-- End Sidebar -->

<div class="main-panel">
    <div class="content" id="mainpanel" style="background-color:#fffefa">
        @*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*@
        @*行事曆*@
        <div class="page-inner">
            <div class="row">
                <div class="col-md-12">
                    <div class="card" id="mmmmmm">
                        <div class="row">
                            <div class="card col-md-7" id="calendar"></div>
                            <div class="card col-md-2" id="calendar_open"></div>
                        </div>



                        @*行事曆*@

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="aaaa"></div>
    <footer class="footer">
        <div class="container-fluid">
            <nav class="pull-left">
                <ul class="nav"></ul>
            </nav>
            <div class="copyright ml-auto">
                MSIT123。AMS差勤專題
            </div>
        </div>
    </footer>
</div>

<!-- Modal -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">
                    Shipper
                    <span></span>
                </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addForm">
                    <div class="card" id="calendar_open"></div>
                </form>
            </div>
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary" id="buttonSend">送出</button>
                </div>*@
        </div>
    </div>
</div>
@section scripts
{
    @Scripts.Render("~/bundles/jqueryval")
    <script>




     //////////////////////睿//////////////////////////////////
        @*function outPDF() {
            let valuearray = new Array()
            for (let item of $("input[name='value']:checked")) {  //判斷是否combobox checked
                valuearray.push(item.value)
            }
            var param = {
                "value": valuearray,
                "id": $("#StartTime").val(),
                "id2": $("#EndTime").val(),

            };
            $.ajax({
                url: "@Url.Action("ToPdf", "LeaveRequests")",
                type: "POST",
                data: param,
                dataType: "json",
            }).done(function (response) {

                window.location = "/home/DownloadInvoice" + "?fName=" + response.fName;
                }).fail(function (error) {
                alert(error.statusText)});
        }*@



        function Export() {  //匯出excel方法
            let valuearray = new Array()
            for (let item of $("input[name='value']:checked")) {  //判斷是否combobox checked
                valuearray.push(item.value)
            }
            var value = "{'value':valuearray}"
            var param = {
                "value": valuearray,
                "id": $("#StartTime").val(),
                "id2": $("#EndTime").val(),

            }.done();
            $.ajax({
                url:"@Url.Action("DownLoadExcel", "LeaveRequests")", /*'/LeaveRequests/DownLoadExcel',*/ //Controller名稱和方法名
                type: "POST",
                dataType: "json",
                data: param,
                success: function (data) {
                    //重定向返回引數
                    location.href = "/LeaveRequests/OutExcel?guid=" + data;
                }
            });
        }


    function funLeaveIndex() {  //到搜尋頁面
    $.ajax({
    type: "GET",
    url: "@Url.Action("LeaveIndexView", "LeaveRequests")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();


          $(document).ready(function () {
              changeT();
            $("#CheckAll").click(cAll);                //全選功能
            $('#Search').bind("click",
                function () {
                    Lrsearch();
                  });
            d = new Date();
            $("#StartTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()-7));
            $("#EndTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()+1));
        });


            function cAll() {
                if ($("#CheckAll").prop("checked")) {                  //如果全選按鈕有被選擇的話（被選擇是true）
                    $("input[name='value']").each(function () {
                        $(this).prop("checked", true);                 //把所有的核取方框的property都變成勾選
                    })
                } else {
                    $("input[name='value']").each(function () {
                        $(this).prop("checked", false);                //把所有的核方框的property都取消勾選
                    })
                }
            }




        function Lrsearch() {
            let a = $("#StartTime").val()
            let st = a.split('-')
            let Start = st[0] + st[1] + st[2]
            let et = $("#EndTime").val().split('-')
            let End = et[0] + et[1] + et[2]

            let valuearray = new Array()
            for (let item of $("input[name='value']:checked")) {  //判斷是否combobox checked
                valuearray.push(item.value)
            }
            var value = "{'value':valuearray}"
            $.ajax({

                type: "Post",                                      //使用post
                url: "@Url.Action("Leave11", "LeaveRequests")",
                data: {                                            //帶入值傳到controller
                    "value": valuearray,
                    "id":/*$("#StartTime").val(),*/StartTime.value,
                    "id2": $("#EndTime").val(),

                },
                }).done(function (result) {                        //正確做這個
                    $("#LeaveTable").html(result);
                    changeT();
                }).fail(function(e){                               //錯誤做這個
                alert(e.responseText);
                });
        }
        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }

        $("#StartTime").bind("change", function () {
            if ($("#StartTime").val() > $("#EndTime").val()) {
                timechange();
                $("#StartTime").val($("#EndTime").val());
            }
        });

        function timechange() {
            swal("起始時間不可大於最後時間!", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

        $("#EndTime").bind("change", function () {
            if ($("#EndTime").val() < $("#StartTime").val()) {
                timechange();
                $("#EndTime").val($("#StartTime").val());
            }

        });


    }).fail(function (e) { alert(e.responseText) });
    }






    function funLeaveCreate() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Create", "LeaveRequests")",
    dataType: "html",
    }).done(function (result) {
        $("#aaaa").html(result);

        $('#addModal').modal('show');
        changeT();


        /////create_start
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#imgPreview').attr('src', e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        $("#LeaveFile").change(function () {
            readURL(this);
        });

        //$(document).ready(function () {
        //    $("#RequestTime").val(new Date().toJSON().slice(0, 19));;
        //});
        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        $(document).ready(function () {
            d = new Date();
            $("#RequestTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + d.getHours() + ":" + d.getMinutes());
        });

        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        $(document).ready(function () {
            d = new Date();
            $("#StartTime_leave_create").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
        });

        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        $(document).ready(function () {
            d = new Date();
            $("#EndTime_leave_create").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "18" + ":" + "00");
        });
        //////////以下是時間防呆
        $("#StartTime_leave_create").bind("change", function () {
            if ($("#StartTime_leave_create").val() > $("#EndTime_leave_create").val()) {
                timechange();
                $("#StartTime_leave_create").val($("#EndTime_leave_create").val());
            }
        });

        function timechange() {
            swal("起始時間不可大於最後時間!", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

        $("#EndTime_leave_create").bind("change", function () {
            if ($("#EndTime_leave_create").val() < $("#StartTime_leave_create").val()) {
                timechange();
                $("#EndTime_leave_create").val($("#StartTime_leave_create").val());
            }

        });

    }).fail(function (e) { alert(e.responseText) });
    }
     /////create_End

    ////////////////////////////////////////////////////////
     //////////////////////瑋////////////////////////////////
        function funSerchAttendancest() {

            $.ajax({
                url: "@Url.Action("SerchAttendances", "Attendances")",
                type: "GET",
                dataType: "html",

                //data: {"EmployeeID": EmployeeID.value,},
            }).done(function (result) {
                $("#mainpanel").html(result);

                $(document).ready(function () {
                    d = new Date();
                    $("#time1").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() + 2));
                    $("#time2").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() + 2));
                    //$("#mainpanel").html(result);
                    //changeT();
                });

        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        $("#time1").bind("change", function () {
            if ($("#time1").val() > $("#time2").val()) {
                timechange();
                $("#time1").val($("#time2").val());
            }

        });



        function timechange() {
            swal("起始時間不可大於最後時間!", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

        $("#time2").bind("change", function () {
            if ($("#time2").val() < $("#time1").val()) {
                timechange();
                $("#time2").val($("#time1").val());
            }

        });

        $("#Button1").bind("click", function () {
            AttendancesSave();
        })

    }).fail(function (e) { alert(e.responseText) });


    }
        /////////////////////////////////////////////////
        function funClockInApplyCreat() {

    $.ajax({
        type: "GET",
    url: "@Url.Action("ClockinApply", "ClockInApply")",
    dataType: "html",
    }).done(function (result) {
        $("#aaaa").html(result);
        $('#addModal').modal('show');
             d = new Date();
            $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            $("#OffDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "16" + ":" + "00");
            $("#RequestDate").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()));
            //document.getElementById("RequestDate").readonly= true;
        /////////////////////////////////////////////////////////

        $("#OnDuty").bind("change", function () {
            var str = $("#OnDuty").val();
            var Today = $("#RequestDate").val();
            var searchstr = str.substring(11, 13);
            var searchstrmi = str.substring(14, 16);
            //if ($("#OnDuty").val() > $("#OffDuty").val()) {
            //    //timechange();
            $("#OffDuty").val($("#OnDuty").val());
            //}

            if (searchstr > 12 || searchstr < 06) {
                timechange();
                $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            }
            else if (str >= Today) {
                Datechange();
                $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            }


        });

        function Datechange() {
            swal("無法提交隔日後之申請", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }
        function sethours(hours) {
            var start = document.querySelector("#OnDuty"), end = document.querySelector("#OffDuty");
            $("#OffDuty").val($("#OnDuty").val());
            end.value = start.value;
            end.stepUp(hours);
            //$("#time1").on("click keyup", function () {

            //    end.value = start.value;
            //    end.stepUp(hours);
            //});
        }
        $("input[name='inlineDefaultRadiosExample']").bind("change", function () {

            var ele = $("input[name='inlineDefaultRadiosExample']:checked").val()
            switch (ele) {

                case "1":
                    sethours(60)
                    break;
                case "2":
                    sethours(120)
                    break;
                case "3":
                    sethours(180)
                    break;
                case "4":
                    sethours(240)
                    break;
                case "5":
                    sethours(300)
                    break;
                case "6":
                    sethours(360)
                    break;
                case "7":
                    sethours(420)
                    break;
                case "8":
                    sethours(480)
                    break;

            }


        });



        function timechange() {
            swal("上班時間請在06:00-11:59之間設定", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

        $("#submitButton").bind("click", function () {
            Clockinsave();
            test();
        })

    }).fail(function (e) { alert(e.responseText) });
    }

        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }

        function Clockinsave() {
            var data = new FormData();
            data.append("OnDuty", OnDuty.value);
            data.append("OffDuty", OffDuty.value);
            data.append("RequestDate", RequestDate.value);
      $.ajax({
    url: "@Url.Action("ClockinApply", "ClockInApply")",
    type: "POST",
    contentType: false,         // 告诉jQuery不要去這置Content-Type
    processData: false,         // 告诉jQuery不要去處理發送的數據
    dataType: "html",
    data: data,

    //data: {"EmployeeID": EmployeeID.value,},
    }).done(function (result) {
        $("#mainpanel").html(result);
       value='@TempData["Message"]';





    }).fail(function (e) { alert(e.responseText) });


    }

    function test() {

     $.ajax({
    type: "GET",
    url: "@Url.Action("ClockInApplyView", "ClockInApply")",
    dataType: "html",
    }).done(function (result) {
       $("#mainpanel").html(result);
       changeT();


    }).fail(function (e) { alert(e.responseText) });


    }
    function AttendancesSave() {
        var data = new FormData;
        //data.get("time1");
        //data.get("time2");
        data.append("time1", $('#time1').val());
        data.append("time2", $('#time2').val());
        //    time1: $('#time1').val(),
        //    time2: $('#time2').val()
        //}
      $.ajax({
    url: "@Url.Action("SerchAttendances", "Attendances")",
    type: "POST",
    contentType: false,         // 告诉jQuery不要去這置Content-Type
    processData: false,         // 告诉jQuery不要去處理發送的數據
    dataType: "html",
    data: data,

    //data: {"EmployeeID": EmployeeID.value,},
    }).done(function (result) {
        $("#mainpanel").html(result);

        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        d = new Date();
        $("#time1").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() + 2));
        $("#time2").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() + 2));

        $("#time1").bind("change", function () {
            if ($("#time1").val() > $("#time2").val()) {
                timechange();
                $("#time1").val($("#time2").val());
            }

        });
        function timechange() {
            swal("起始時間不可大於最後時間!", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

        $("#time2").bind("change", function () {
            if ($("#time2").val() < $("#time1").val()) {
                timechange();
                $("#time2").val($("#time1").val());
            }

        });

        $("#Button1").bind("click", function () {
            AttendancesSave();
        })

    }).fail(function (e) { alert(e.responseText) });


    }

      ////////////////////////瑋////////////////////////////////
    //////////////////汪///////////////////////////////


    function funReview() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Index", "Review")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();

                $("#Customers").bind("change", function () {
                    Switch();
                });

                $("#ddlemp").bind("change", function () {
                    Switch();
                });
        $("#CheckAll").click(cAll);



    }).fail(function (e) { alert(e.responseText) });
    }

     function Switch() {

            switch ($('#urlddl').val()) {
                case '1':
                   var u = "@Url.Action("AjaxLeave","Review")/"
                    break;
                case '2':
                   var u = "@Url.Action("Ajax","Review")/"
                    break;
                case '3':
                   var u = "@Url.Action("AjaxOverTime","Review")/"
                    break;

                default:
            }

            UpdateEmployeesByDepartment22(u)
        }
    function cAll() {
        if ($("#CheckAll").prop("checked")) {//如果全選按鈕有被選擇的話（被選擇是true）
            $("input[name='Checkboxxx']").each(function () {
                $(this).prop("checked", true);//把所有的核取方框的property都變成勾選
            })
        } else {
            $("input[name='Checkboxxx']").each(function () {
                $(this).prop("checked", false);//把所有的核方框的property都取消勾選
            })
        }
    }
    function UpdateEmployeesByDepartment22(u) {
        $.ajax({
            type: "GET",
                @* url: "@Url.RouteUrl("Default", new { controller = "Review", action = "Ajax" })/" + "null/" + Customers.value,*@
        url: u + Customers.value
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();
        $("#CheckAll").click(cAll);
    }).fail(function (e) { alert(e.responseText) });

              //$("#CheckAll").click(cAll);
              //$("#CheckAll").click(a());
              //$("#CheckAll").click(cAll);
        }

    function a() {
        alert('a');
    }

    function UpdateSuccess() {
        swal("審核完成", "", {
            icon: "info",
            buttons: {
                confirm: {
                    className: 'btn btn-info'
                }
            },
        });
    }




    ///////////////////////正//////////////////////
    $("#EmployeeManagement").bind("click", funEmpM);
    window.addEventListener('resize', changeT);
    function funSerchOvt() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("SerchOverTime", "Employees")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();

    }).fail(function (e) { alert(e.responseText) });
    }

     function funSerchAds() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("SerchAttendances", "Employees")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();

    }).fail(function (e) { alert(e.responseText) });
    }


    function funSerchLev() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("SerchLeave", "Employees")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();

    }).fail(function (e) { alert(e.responseText) });
    }


    function funEmpM() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Index", "Employees")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        IndexEventFunction();
    }).fail(function (e) { alert(e.responseText) });
    }

    function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
            $('#s1').attr('src', e.target.result);
        };
        reader.readAsDataURL(input.files[0]);
    }
}
//$(document).ready(function () {
//    IndexEventFunction();
//});

function createmp() {
    $.ajax({
        type: "GET",
        url: "@Url.Action("Create","Employees")",
    }).done(function (result) {
        $("#mmmmmm").html(result);
        $("#empFile").bind("change", function () {
            readURL(this);
        });
        $("#btn1").bind("click", function () {
            savemp();
        });
        $("#btnback").bind("click", BackToIndexFunction);
    }).fail(function (e) { alert(e.responseText) });
}

function savemp() {
    var data = new FormData();
    data.append("EmployeeID", EmployeeID.value);
    data.append("EmployeeName", EmployeeName.value);
    data.append("Email", Email.value);
    data.append("IDNumber", IDNumber.value);
    data.append("DeputyPhone", DeputyPhone.value);
    data.append("Deputy", Deputy.value);
    data.append("Marital", Marital.value);
    data.append("Birthday", Birthday.value);
    data.append("Hireday", Hireday.value);
    data.append("Address", Address.value);
    data.append("Phone", Phone.value);
    data.append("DepartmentName", DepartmentName.value);
    data.append("JobTitle", JobTitle.value);
    data.append("EnglishName", EnglishName.value);
    data.append("gender", gender.value);
    data.append("Notes", Notes.value);
    data.append("Education", Education.value);

    var files = $("#empFile").get(0).files;
    if (files.length > 0) {
        data.append("Photo", files[0]);
    }
    $.ajax({
        url: "@Url.Action("Create","Employees")",
        type: "POST",
        contentType: false,         // 告诉jQuery不要去這置Content-Type
        processData: false,         // 告诉jQuery不要去處理發送的數據
        dataType: "html",
        data: data,
        //data: {"EmployeeID": EmployeeID.value,},
    }).done(function (result) {
        $("#mmmmmm").html(result);
        IndexEventFunction();
        alert('XXXX');

    }).fail(function (e) { alert(e.responseText) });
        }


        function editemp() {
    var data = new FormData();
    data.append("EmployeeID", EmployeeID.value);
    data.append("EmployeeName", EmployeeName.value);
    data.append("Email", Email.value);
    data.append("IDNumber", IDNumber.value);
    data.append("DeputyPhone", DeputyPhone.value);
    data.append("Deputy", Deputy.value);
    data.append("Marital", Marital.value);
    data.append("Birthday", Birthday.value);
    data.append("Hireday", Hireday.value);
    data.append("Address", Address.value);
    data.append("Phone", Phone.value);
    data.append("DepartmentName", DepartmentName.value);
    data.append("JobTitle", JobTitle.value);
    data.append("EnglishName", EnglishName.value);
    data.append("gender", gender.value);
    data.append("Notes", Notes.value);
    data.append("Education", Education.value);

    var files = $("#empFile").get(0).files;
    if (files.length > 0) {
        data.append("Photo", files[0]);
    }
    $.ajax({
        url: "@Url.Action("Edit","Employees")",
        type: "POST",
        contentType: false,         // 告诉jQuery不要去這置Content-Type
        processData: false,         // 告诉jQuery不要去處理發送的數據
        dataType: "html",
        data: data,
        //data: {"EmployeeID": EmployeeID.value,},
    }).done(function (result) {
        $("#mmmmmm").html(result);
        IndexEventFunction();
        alert('XXXX');

    }).fail(function (e) { alert(e.responseText) });
}



function Updateddl() {
    $.ajax({

        type: "GET",
        url: "@Url.Action("GetDdlandListemp","Employees")/" + Department.value,
    }).done(function (result) {
        $("#ddlemp").html(result);
        $("#Employees").bind("change", function () {
            UpdateEmployeesByEmployee();

        });
    }).fail(function (e) { alert(e.responseText) });
}


function UpdateEmployeesByEmployee() {
    $.ajax({

        type: "GET",
        url: "@Url.RouteUrl("Default1", new { controller = "Employees", action = "Listemp" })/" + Employees.value + "/" + Department.value,
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();

        $("input[name*='MSIT']").bind("click", function () {
            if (event.target.name.substr(0, 2) == "De") {
                funbtndetails(event.target.name.substr(2));
            }
            else if (event.target.name.substr(0, 2) == "Ed") {
                funbtnedit(event.target.name.substr(2));
            }

        });
    }).fail(function (e) { alert(e.responseText) });
}


function UpdateEmployeesByDepartment() {
    $.ajax({
        type: "GET",
        url: "@Url.RouteUrl("Default1", new { controller = "Employees", action = "Listemp" })/" + "null/" + Department.value,
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();

        $("input[name*='MSIT']").bind("click", function () {

            if (event.target.name.substr(0, 2) == "De") {
                funbtndetails(event.target.name.substr(2));
            }
            else if (event.target.name.substr(0, 2) == "Ed"){
                funbtnedit(event.target.name.substr(2));
            }


        });
    }).fail(function (e) { alert(e.responseText) });
}

function funbtnedit(s) {
    $.ajax({
        type: "GET",
        url: "@Url.Action("Edit", "Employees")/" + s,
        dataType: "html",
    }).done(function (result) {
        $("#mmmmmm").html(result);
        $("#btnback").bind("click", BackToIndexFunction);
        $("#empFile").bind("change", function () {
            readURL(this);
        });

        $("#btneditpost").bind("click", function () {
            editemp();
        });
    }).fail(function (e) { alert(e.responseText) });
}



function funbtndetails(s) {
    $.ajax({
        type: "GET",
        url: "@Url.Action("Details", "Employees")/" + s,
        dataType: "html",
    }).done(function (result) {
        $("#mmmmmm").html(result);
        $("#btnback").bind("click", BackToIndexFunction);
    }).fail(function (e) { alert(e.responseText) });
}

function BackToIndexFunction() {
    $.ajax({
        type: "GET",
        url: "@Url.Action("backIndex", "Employees")",
    }).done(function (result) {
        $("#mmmmmm").html(result);
        IndexEventFunction();
    }).fail(function (e) { alert(e.responseText) });
}

    function changeT() {

        if (window.innerWidth >= 600)
        {

            $('#basic-datatables').DataTable({
                destroy: true
            });
            $("#basic-datatables_filter").hide();
        }
        else {

            $('#basic-datatables').basictable("destroy");
            $('#basic-datatables').basictable({ breakpoint: 600 });
        }
    }

    function IndexEventFunction() {
      changeT();



    //$('#basic-datatables').DataTable({
    //});
    //$('#basic-datatables').basictable();

    $("#Employees").bind("change", UpdateEmployeesByEmployee);
    $("#Department").bind("change", function () {
        UpdateEmployeesByDepartment();
        Updateddl();
    });
    $("#Button1").bind("click", createmp);
    $("input[name*='MSIT']").bind("click", function () {

        if (event.target.name.substr(0, 2) == "De") {
            funbtndetails(event.target.name.substr(2));
        }
        else if (event.target.name.substr(0, 2) == "Ed") {
            funbtnedit(event.target.name.substr(2));
        }

    });

}


    </script>

    <script>
        /////////////////WU//////////////////
        function OverTimeIndex() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Index", "OverTimeRequests")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        $('#basic-datatables').DataTable({
        });
        $("#basic-datatables_filter").hide();
        $('#Search').bind("click",
            function () {
                OTsearch();
            });
        d = new Date();
        $("#StartTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-01");
        $("#EndTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()));
        $("#StartTime").bind("change", function () {
            if ($("#StartTime").val() > $("#EndTime").val()) {
                timechange();
                $("#StartTime").val($("#EndTime").val());
            }

        });

        $("#EndTime").bind("change", function () {
            if ($("#EndTime").val() < $("#StartTime").val()) {
                timechange();
                $("#EndTime").val($("#StartTime").val());
            }
        });
    }).fail(function (e) { alert(e.responseText) });
        }

         function OTsearch() {
            let a = $("#StartTime").val()
            let st = a.split('-')
            let Start = st[0] + st[1] + st[2]
            let et = $("#EndTime").val().split('-')
            let End = et[0] + et[1] + et[2]
            $.ajax({

                type: "GET",
                url: "@Url.RouteUrl("Default1", new { controller = "OverTimeRequests", action = "Overtimetable" })/" + Start + "/" + End,
            }).done(function (result) {

                    $("#OverTimeTable").html(result);
                    $('#basic-datatables').DataTable({
                });
                $("#basic-datatables_filter").hide();
                }).fail(function(e){
                alert(e.responseText);
                });
        }
        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        function timechange() {
            swal("起始時間不可大於最後時間!", "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
        }

    function OverTimeCreate() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Create", "OverTimeRequests")",
    dataType: "html",
    }).done(function (result) {
        d = new Date();
        $("#aaaa").html(result);

        $('#addModal').modal('show');
        $("#StartTime_wu_creat").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "17" + ":" + "00");
        $("#EndTime_wu_creat").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "19" + ":" + "00");
        $("#StartTime_wu_creat").bind("change", function () {
            if ($("#StartTime_wu_creat").val() > $("#EndTime_wu_creat").val()) {
                timechange();
                $("#StartTime_wu_creat").val($("#EndTime_wu_creat").val());
            }

        });

        $("#EndTime_wu_creat").bind("change", function () {
            if ($("#EndTime_wu_creat").val() < $("#StartTime_wu_creat").val()) {
                timechange();
                $("#EndTime_wu_creat").val($("#StartTime_wu_creat").val());
            }

        });

    }).fail(function (e) { alert(e.responseText) });
        }


      function CreateNewOT() {
    var data = new FormData();
          data.append("StartTime", StartTime.value);
          data.append("EndTime", EndTime.value);
          data.append("OverTimePay", OverTimePay.value);
          data.append("OverTimeReason", OverTimeReason.value);

    $.ajax({
        url: "@Url.Action("Create","OverTimeRequests")",
        type: "POST",
        contentType: false,         // 告诉jQuery不要去這置Content-Type
        processData: false,         // 告诉jQuery不要去處理發送的數據
        dataType: "json",
        data: data,

    }).done(function (result) {


        alert('已送出申請');
        OverTimeIndex();
        }).fail(function (e) {
            alert(e.responseJSON.Message);

        });
        }



        @*function opencalendar() {
            $('#addModal').modal('show');
            var calendarEl_open = document.getElementById('calendar_open');
            var calendar = new FullCalendar.Calendar(calendarEl_open, {
                plugins: ['dayGrid'],
                events: "@Url.Action("LoadCalender", "Home")",
                lazyFetching: false,
            });

            calendar.render();
        };*@


    function OverTimeDetails(requestid) {
    $.ajax({
    type: "GET",
        url: "@Url.Action("Details", "OverTimeRequests")",
        data: { "id": requestid},
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);

    }).fail(function (e) { alert(e.responseText) });
    }


        //Calendar
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: ['dayGrid'],
                events: "@Url.Action("LoadCalender", "Home")",
                lazyFetching: false,
            });

            calendar.render();
            //$('#fc-prev-button fc-button fc-button-primary').bind('click',)
            //////////////////////////////////////////////////

            var calendarEl_open = document.getElementById('calendar_open');
            var calendar_opne = new FullCalendar.Calendar(calendarEl_open, {
                plugins: ['dayGrid'],
                events: "@Url.Action("LoadCalender", "Home")",
                lazyFetching: false,
            });
            calendar_opne.render();





        });

        $("#calendar").click(function () {
            $('#addModal').modal('show');

        })





    </script>
}
