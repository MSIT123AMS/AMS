

@{
    ViewBag.Title = "Index";
}

@section styles{
    @*<style>
            #calendar {
                /*font-size: 30px;*/
            }
        </style>*@
    @*<style>
            /* Always set the map height explicitly to define the size of the div
            * element that contains the map. */
            #map {
                height: 100%;
            }
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>*@
}

<!-- Sidebar -->
<div class="sidebar sidebar-style-2 noprint">
    <div class="sidebar-wrapper scrollbar scrollbar-inner" style="font-family:'Microsoft JhengHei'">
        <div class="sidebar-content">
            <div class="user">
                <div class="avatar-sm float-left mr-2">
                    <img src="~/assets/img/woman.jpg" alt="..." class="avatar-img rounded-circle">
                </div>
                <div class="info">
                    <a data-toggle="collapse" href="#collapseExample" aria-expanded="true">
                        <span style="font-family:'Microsoft JhengHei'">
                            @Session["UserFullName"]
                        </span>
                    </a>
                    <div class="clearfix"></div>
                </div>
            </div>
            <ul class="nav nav-primary">

                <li class="nav-section">
                    <span class="sidebar-mini-icon">
                        <i class="fa fa-ellipsis-h"></i>
                    </span>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#base">
                        <i class="fa fa-search search-icon"></i>
                        <p style="font-family:'Microsoft JhengHei'">查詢</p>
                        <span class="caret"></span>
                    </a>
                    <div class="collapse" id="base">
                        <ul class="nav nav-collapse" style="font-family:'Microsoft JhengHei'">
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">
                                        個人出勤明細查詢
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="funSerchAttendancest()" )>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人刷卡明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="funLeaveIndex()" )>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人差假明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="OverTimeIndex()">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人加班明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">打卡申覆統計表</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人差勤統計查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">個人月勤惰統計</span>
                                </a>
                            </li>

                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#sidebarLayout2">
                        <i class="fas fa-th-list"></i>
                        <p style="font-family:'Microsoft JhengHei'">主管區</p>
                        <span class="caret"></span>
                    </a>
                    <div class="collapse" id="sidebarLayout2">
                        <ul class="nav nav-collapse">
                            <li>
                                <a href="#" onclick='PageAjax("@Url.Action("Index", "Review")","審核")'>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">審核</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#sidebarLayouts1">
                        <i class="fas fa-users"></i>
                        <p style="font-family:'Microsoft JhengHei'">人資區</p>
                        <span class="caret"></span>
                    </a>
                    <div class="collapse" id="sidebarLayouts1">
                        <ul class="nav nav-collapse">
                            <li>
                                <a href="#" onclick='PageAjax("@Url.Action("Index", "Employees")","員工管理")'>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">員工管理</span>
                                </a>
                            </li>
                            <li>
                                <a href="#">

                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">
                                        部門管理
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick='PageAjax("@Url.Action("SerchAttendances", "Employees")","刷卡明細查詢")'>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">刷卡明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick='PageAjax("@Url.Action("SerchLeave", "Employees")","差假明細查詢")'>

                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">差假明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick='PageAjax("@Url.Action("SerchOverTime", "Employees")","加班明細查詢")'>
                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">加班明細查詢</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick='PageAjax("@Url.Action("DailyStatistics", "Employees")","日期員工出勤統計")'>

                                    <span class="sub-item" style="font-family:'Microsoft JhengHei'">日期員工出勤統計</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- End Sidebar -->
<body>
    <div class="main-panel">
        <div class="content" id="mainpanel" style="background-color:#fffefa">
            @*XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX*@
            @*行事曆*@
            <div class="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card" id="mmmmmm">
                            <div class="row">
                                <div class="card col-md-7" id="calendar"></div>
                                
                            </div>

                            @*行事曆*@

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="aaaa"></div>
        <footer class="footer">
            <div class="container-fluid">
                <nav class="pull-left">
                    <ul class="nav"></ul>
                </nav>
                <div class="copyright ml-auto">
                    MSIT123。AMS差勤專題
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                        Shipper
                        <span></span>
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addForm">
                        <div class="card" id="calendar_open"></div>
                    </form>
                </div>
                @*<div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                        <button type="button" class="btn btn-primary" id="buttonSend">送出</button>
                    </div>*@
            </div>
        </div>
    </div>
</body>
<!-- Sidebar -->

@section scripts
{
    @Scripts.Render("~/bundles/jqueryval")
<script>
       //圖檔顯示
        function readURL(input) {
            if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imgPreview').attr('src', e.target.result);
            };
            reader.readAsDataURL(input.files[0]);
            }
        }

        function Datechange() {
            SweetAlert("無法提交隔日後之申請");
        }
        function timechange1() {
            SweetAlert("上班時間請在06:00-11:59之間設定");
        }
        function timechange() {
            SweetAlert("起始時間不可大於最後時間!");
        }
        function UpdateSuccess() {
            SweetAlert("審核完成");
        }
    function SweetAlert(alertstring) {


            swal(alertstring, "", {
                icon: "info",
                buttons: {
                    confirm: {
                        className: 'btn btn-info'
                    }
                },
            });
            //$.confirm({

            //        title: '警告',
            //    content: `<h2 style="font-family:微軟正黑體;">${alertstring}</h2>`,

            //        icon: 'fa fa-question',
            //        theme: 'bootstrap',
            //        closeIcon: true,
            //        animation: 'scale',
            //        type: 'orange',
            //        buttons: {
            //            '確認': {
            //                function() {
            //                    $.alert('您好!');
            //                },
            //                btnClass: 'btn btn-primary'
            //            },
            //        '取消': function () {
            //            $.alert('您不好!');
            //        }
            //    }
            //    });

    }
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        }
    };
       

        function zeroPadded(val) {
            if (val >= 10)
                return val;
            else
                return '0' + val;
        }
        //time1:初始,time2:結束
        function TimeErrorProof(time1, time2) {
            time1.bind("change",()=>{
                if (time1.val() > time2.val()) {
                    timechange();
                    time1.val(time2.val());
                }
            });
            time2.bind("change", ()=>{
                if (time1.val() > time2.val()) {
                    timechange();
                    time2.val(time1.val());
                }
            });
        }
        //設定TimePicker起始值X/1~X/30
        function SetTimePicker(time1, time2) {
            d = new Date();
            time1.val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-01");
            time2.val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()));
            TimeErrorProof(time1, time2)
    }

        function PageAjax(PageUrl, sta) {
        $.ajax({
            type: "GET",
            url: PageUrl,
            dataType: "html",
        }).done(function (result) {
            $("#mainpanel").html(result);

            switch (sta) {
                case '員工管理':
                    IndexEventFunction();
                    break;
                case '審核':
                    {
                        changeT();
                        $("#Customers").bind("change", Switch);
                        $("#ddlemp").bind("change", Switch);
                        $("#CheckAll").click(cAll);
                        $("input[name*='Le']").bind("click", function () {
                            Reviewfunbtndetails(event.target.name.substr(2));
                        });

                        break;
                    }
                case '日期員工出勤統計':
                    {

                        //SetTimePicker($("#time1"), $("#time2"));
                        GetDailyStatistics();
                        break;
                    }
                default:
                    changeT();
                    SetTimePicker($("#time1"), $("#time2"));
                    break;
            }
        }).fail(function (e) { alert(e.responseText) });
        }
    ////換Table樣式
    function changeT() {

        //if (window.innerWidth >= 600) {

            $('#basic-datatables').DataTable({
                destroy: true,
                responsive: true
            });
            $("#basic-datatables_filter").hide();
        //}
        //else {

        //    $('#basic-datatables').basictable("destroy");
        //    $('#basic-datatables').basictable({ breakpoint: 600 });
        //}
    }

    //window.addEventListener('resize', changeT);
       /////////////////////正///////////////////////////////////
    function EmployeeDetailsToEdit() {
        $(":input").attr("readonly",false)//去除input元素的readonly屬性
    }

    function EmployeePrint() {
        $('#basic-datatables').DataTable({
            destroy: true,
            paging: false,
            ordering: false,
            info: false,
           
        });
        $("#basic-datatables_filter").hide();
        $('#basic-datatables').removeClass("table");
        window.print();
        changeT();
        $('#basic-datatables').addClass("table");

    }
    function IndexEventFunction() {
        changeT();


        $("#Employees").bind("change", UpdateEmployeesByEmployee);
        $("#Department").bind("change", function () {
            UpdateEmployeesByDepartment();
            Updateddl();
        });
    }
    function GetDailyStatistics() {
        $.ajax({
            type: "GET",
            url: "@Url.Action("GetDailyStatistics", "Employees")/",
            dataType: "json",
        }).done(function (datas) {
            console.log(datas);

            $("#statisticsnum1").text(`${datas[4].人數}`)
            $("#statisticsnum2").text(`${datas[4].未到}`)
            $("#statisticsnum3").text(`${datas[4].請假}`)
            



            var ctx = document.getElementById('myChart');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['行銷部', '業務部', '會計部','資訊部','人資部','工程部','研發部'],
                    datasets: [{
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                                'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(255, 206, 86, 0.2)' 
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                             'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1,
                        label: '出席率(%)',
                        data: [Math.ceil(((datas[0].人數 - datas[0].未到) / datas[0].人數)* 100), Math.ceil(((datas[1].人數 - datas[1].未到) / datas[1].人數)* 100), Math.ceil(((datas[2].人數 - datas[2].未到) / datas[2].人數)* 100),
                            Math.ceil(((datas[3].人數 - datas[3].未到) / datas[3].人數)* 100), Math.ceil(((datas[4].人數 - datas[4].未到) / datas[4].人數)* 100), Math.ceil(((datas[5].人數 - datas[5].未到) / datas[5].人數)* 100),
                            Math.ceil(((datas[6].人數 - datas[6].未到) / datas[6].人數)* 100)]
                    }]
                },
                options: {
                    onClick: function (c, i) {
                        e = i[0];
                        console.log(e._index+1)
                        var x_value = this.data.labels[e._index];
                        var y_value = this.data.datasets[0].data[e._index];
                        $("#StatisticsDepartmentName").text(x_value);
                        console.log(y_value);
                        GetDailyStatisticsDataByDepartment(e._index + 1)
                        GetDailyStatisticsByDepartment(e._index + 1 );
                    }
                },

            });



        }).fail(function (e) { alert(e.responseText) });
    }

    function EmployeesPageAjax(PageUrl, sta) {
        $.ajax({
            type: "GET",
            url: PageUrl,
            dataType: "html",
        }).done(function (result) {
            $("#mmmmmm").html(result);

            switch (sta) {
                case 'creat':
                    $("#empFile").bind("change", function () {
                        readURL(this);
                    });
                    break;
                case 'edit':
                    {
                        $("#empFile").bind("change", function () {
                            readURL(this);
                        });
                        break;
                    }
                case 'details':
                    {
                        break;
                    }
                default:
                    break;
            }
        }).fail(function (e) { alert(e.responseText) });
    }
     ///post
    function SaveFormDataUseAjaxPost(AjaxUrl) {

        let myForm = document.querySelector("#FormData");
        var validator =$("#FormData").validate({
            //rules: {
            //    EmployeeName: {
            //        required: true,
            //        minlength: 5
            //    },
            //},messages: {
            //    EmployeeName: {
            //        required: "不可為空值",
            //        minlength: "XXXX",
            //    },
            //},
            debug: true
        }
        );
        console.log(validator);
        let data = new FormData(myForm);
        //data.append("DepartmentID","2");
        let files = $("#empFile").get(0).files;
        if (files.length > 0) {
            data.append("Photo", files[0]);
        }
        $.ajax({
            url:AjaxUrl,
            type: "POST",
            contentType: false,         // 告诉jQuery不要去這置Content-Type
            processData: false,         // 告诉jQuery不要去處理發送的數據
            dataType: "html",
            data: data,
            //data: {"EmployeeID": EmployeeID.value,},
        }).done(function (result) {
            $("#mmmmmm").html(result);
            IndexEventFunction();
            alert('XXXX');

            }).fail(function (e) { SweetAlert("驗證失敗") });
    }
    /////////////////////正///////////////////////////////////



     //////////////////////睿//////////////////////////////////
    function LeaveDetails(requestid) {
    $.ajax({
    type: "GET",
        url: "@Url.Action("Details", "LeaveRequests")",
        data: { "id": requestid},
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);

    }).fail(function (e) { alert(e.responseText) });
    }

        function Export() {  //匯出excel方法
            let valuearray = new Array()
            for (let item of $("input[name='value']:checked")) {  //判斷是否combobox checked
                valuearray.push(item.value)
            }
            var value = "{'value':valuearray}"
            var param = {
                "value": valuearray,
                "id": $("#StartTime").val(),
                "id2": $("#EndTime").val(),

            }
            $.ajax({
                url:"@Url.Action("DownLoadExcel", "LeaveRequests")", /*'/LeaveRequests/DownLoadExcel',*/ //Controller名稱和方法名
                type: "POST",
                dataType: "json",
                data: param,
                success: function (data) {
                    //重定向返回引數
                    location.href = "/LeaveRequests/OutExcel?guid=" + data;
                }
            });
        }



    function funLeaveIndex() {  //到搜尋頁面
    $.ajax({
    type: "GET",
    url: "@Url.Action("LeaveIndexView", "LeaveRequests")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();
          $(document).ready(function () {
              changeT();
            $("#CheckAll").click(cAll);                //全選功能
            $('#Search').bind("click",
                function () {
                    Lrsearch();
                  });
            d = new Date();
            $("#StartTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()-7));
            $("#EndTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()+1));
        });


            function cAll() {
                if ($("#CheckAll").prop("checked")) {                  //如果全選按鈕有被選擇的話（被選擇是true）
                    $("input[name='value']").each(function () {
                        $(this).prop("checked", true);                 //把所有的核取方框的property都變成勾選
                    })
                } else {
                    $("input[name='value']").each(function () {
                        $(this).prop("checked", false);                //把所有的核方框的property都取消勾選
                    })
                }
            }




        function Lrsearch() {
            let a = $("#StartTime").val()
            let st = a.split('-')
            let Start = st[0] + st[1] + st[2]
            let et = $("#EndTime").val().split('-')
            let End = et[0] + et[1] + et[2]

            let valuearray = new Array()
            for (let item of $("input[name='value']:checked")) {  //判斷是否combobox checked
                valuearray.push(item.value)
            }
            var value = "{'value':valuearray}"
            $.ajax({

                type: "Post",                                      //使用post
                url: "@Url.Action("Leave11", "LeaveRequests")",
                data: {                                            //帶入值傳到controller
                    "value": valuearray,
                    "id":/*$("#StartTime").val(),*/StartTime.value,
                    "id2": $("#EndTime").val(),

                },
                }).done(function (result) {                        //正確做這個
                    $("#LeaveTable").html(result);
                    changeT();
                }).fail(function(e){                               //錯誤做這個
                alert(e.responseText);
                });
        }

        SetTimePicker($("#StartTime"), $("#EndTime"));




    }).fail(function (e) { alert(e.responseText) });
    }





    function funLeaveCreate() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Create", "LeaveRequests")",
    dataType: "html",
    }).done(function (result) {
        $("#aaaa").html(result);

        $('#addModal').modal('show');
        changeT();


        /////create_start

        $("#LeaveFile").change(function () {
            readURL(this);
        });

        //$(document).ready(function () {
        //    $("#RequestTime").val(new Date().toJSON().slice(0, 19));;
        //});

        $(document).ready(function () {
            d = new Date();
            $("#RequestTime").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + d.getHours() + ":" + d.getMinutes());
        });


        $(document).ready(function () {
            d = new Date();
            $("#StartTime_leave_create").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
        });


        $(document).ready(function () {
            d = new Date();
            $("#EndTime_leave_create").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "18" + ":" + "00");
        });
        //////////以下是時間防呆
        TimeErrorProof($("#StartTime_leave_create"), $("#EndTime_leave_create"));

    }).fail(function (e) { alert(e.responseText) });
    }
     /////create_End

    ////////////////////////////////////////////////////////
     //////////////////////瑋////////////////////////////////
    function funSerchAttendancest() {

      $.ajax({
    url: "@Url.Action("SerchAttendances", "Attendances")",
    type: "GET",
    dataType: "html",

    }).done(function (result) {
        $("#mainpanel").html(result);

        changeT();
        SetTimePicker($("#time1"), $("#time2"));


        $("#Button1").bind("click", function () {
            AttendancesSave();
        })

    }).fail(function (e) { alert(e.responseText) });


    }
        /////////////////////////////////////////////////
        function funClockInApplyCreat() {

    $.ajax({
        type: "GET",
    url: "@Url.Action("ClockinApply", "ClockInApply")",
    dataType: "html",
    }).done(function (result) {
        $("#aaaa").html(result);
        $('#addModal').modal('show');
             d = new Date();
            $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            $("#OffDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "18" + ":" + "00");
            $("#RequestDate").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()));
        $("#OnDuty").bind("change", function () {
            var str = $("#OnDuty").val();
            var Today = $("#RequestDate").val();
            var searchstr = str.substring(11, 13);
            var searchstrmi = str.substring(14, 16);
            $("#OffDuty").val($("#OnDuty").val());          

            //if (searchstr > 12 || searchstr < 06) {
            //    timechange1();
            //    $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            //}
            //else if (str >= Today) {
            //    Datechange();
            //    $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            //}


        });
        function sethours(hours) {
            var start = document.querySelector("#OnDuty"), end = document.querySelector("#OffDuty");
            $("#OffDuty").val($("#OnDuty").val());
            end.value = start.value;
            end.stepUp(hours);
           
        }
        //$("input[name='inlineDefaultRadiosExample']").bind("change", function () {

        //    var ele = $("input[name='inlineDefaultRadiosExample']:checked").val()          
        //    sethours(ele * 60);
        //});
        $("#defaultInline4").bind("change", function () {
            $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            var ele = $("#defaultInline4").val()          
            sethours(ele * 60);
        });
        $("#defaultInline8").bind("change", function () {
            $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "08" + ":" + "00");
            var ele = $("#defaultInline8").val()
            sethours(ele * 60);
        });
        $("#defaultInline7").bind("change", function () {
            $("#OnDuty").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "13" + ":" + "00");
            var ele = $("#defaultInline4").val()
            sethours(ele * 60);
        });
        $("#submitButton").bind("click", function () {
            Clockinsave();
            test();
        })

    }).fail(function (e) { alert(e.responseText) });
    }



        function Clockinsave() {
            var data = new FormData();
            data.append("OnDuty", OnDuty.value);
            data.append("OffDuty", OffDuty.value);
            data.append("RequestDate", RequestDate.value);
      $.ajax({
    url: "@Url.Action("ClockinApply", "ClockInApply")",
    type: "POST",
    contentType: false,         // 告诉jQuery不要去這置Content-Type
    processData: false,         // 告诉jQuery不要去處理發送的數據
    dataType: "html",
    data: data,

    //data: {"EmployeeID": EmployeeID.value,},
    }).done(function (result) {
        $("#mainpanel").html(result);
       value='@TempData["Message"]';





    }).fail(function (e) { alert(e.responseText) });


    }

    function test() {

     $.ajax({
    type: "GET",
    url: "@Url.Action("ClockInApplyView", "ClockInApply")",
    dataType: "html",
    }).done(function (result) {
       $("#mainpanel").html(result);
       changeT();


    }).fail(function (e) { alert(e.responseText) });


    }
    function AttendancesSave() {
        var data = new FormData;
        data.append("time1", $('#time1').val());
        data.append("time2", $('#time2').val());
      $.ajax({
    url: "@Url.Action("SerchAttendances", "Attendances")",
    type: "POST",
    contentType: false,         // 告诉jQuery不要去這置Content-Type
    processData: false,         // 告诉jQuery不要去處理發送的數據
    dataType: "html",
    data: data,
    }).done(function (result) {
        $("#mainpanel").html(result);
        changeT();
        d = new Date();
        $("#time1").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() + 2));
        $("#time2").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate() + 2));

        TimeErrorProof($("#time1"), $("#time2"));
        $("#Button1").bind("click", function () {
            AttendancesSave();
        })
    }).fail(function (e) { alert(e.responseText) });
    }

      ////////////////////////瑋////////////////////////////////
    //////////////////汪///////////////////////////////
    function ReviewPageAjax(PageUrl, sta) {
        $.ajax({
            type: "GET",
            url: PageUrl,
            dataType: "html",
        }).done(function (result) {
            $("#mainpanel").html(result);

            switch (sta) {
                case 'creat':
                    $("#empFile").bind("change", function () {
                        readURL(this);
                    });
                    break;
                case 'edit':
                    {
                        $("#empFile").bind("change", function () {
                            readURL(this);
                        });
                        break;
                    }
                case 'details':
                    {
                        break;
                    }
                default:
                    break;
            }
        }).fail(function (e) { alert(e.responseText) });
    }

    function Reviewfunbtndetails(s) {
    $.ajax({
        type: "GET",
        url: "@Url.Action("Details", "Review")/" + s,
        dataType: "html",
    }).done(function (result) {
        $("#mmmmmm").html(result);
    
    }).fail(function (e) { alert(e.responseText) });
}

     function Switch() {

            switch ($('#urlddl').val()) {
                case '1':
                   var u = "@Url.Action("AjaxLeave","Review")/"
                    break;
                case '2':
                   var u = "@Url.Action("Ajax","Review")/"
                    break;
                case '3':
                   var u = "@Url.Action("AjaxOverTime","Review")/"
                    break;

                default:
            }

            UpdateEmployeesByDepartment22(u)
        }
    function cAll() {
        if ($("#CheckAll").prop("checked")) {//如果全選按鈕有被選擇的話（被選擇是true）
            $("input[name='Checkboxxx']").each(function () {
                $(this).prop("checked", true);//把所有的核取方框的property都變成勾選
            })
        } else {
            $("input[name='Checkboxxx']").each(function () {
                $(this).prop("checked", false);//把所有的核方框的property都取消勾選
            })
        }
    }
    function UpdateEmployeesByDepartment22(u) {
        $.ajax({
        type: "GET",
        url: u + Customers.value
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();
        $("#CheckAll").click(cAll);
    }).fail(function (e) { alert(e.responseText) });

        }

    function a() {
        alert('a');
    }


    ///////////////////////正//////////////////////
      function GetDailyStatisticsDataByDepartment(DepartmentId) {
    $.ajax({
        type: "GET",
        url: "@Url.Action("GetDailyStatisticsDataByDepartment", "Employees")/" + DepartmentId,
        dataType: 'json',
    }).done(function (datas) {
        $("#statisticsnum1").text(`${datas[0].人數}`)
        $("#statisticsnum2").text(`${datas[0].未到}`)
        $("#statisticsnum3").text(`${datas[0].請假}`)

    }).fail(function (e) { alert(e.responseText) });
}
    function GetDailyStatisticsByDepartment(DepartmentId) {
    $.ajax({
        type: "GET",
        url: "@Url.Action("GetDailyStatisticsByDepartment", "Employees")/" + DepartmentId,
        dataType: 'html',
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();

    }).fail(function (e) { alert(e.responseText) });
}
function Updateddl() {
    $.ajax({
        type: "GET",
        url: "@Url.Action("GetDdlandListemp","Employees")/" + Department.value,
    }).done(function (result) {
        $("#ddlemp").html(result);
        $("#Employees").bind("change", function () {
            UpdateEmployeesByEmployee();
        });
    }).fail(function (e) { alert(e.responseText) });
}

function UpdateEmployeesByEmployee() {
    $.ajax({
        type: "GET",
        url: "@Url.Action("UpdateEmployeesByEmployee", "Employees")/" + Employees.value,
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();

    }).fail(function (e) { alert(e.responseText) });
}

function UpdateEmployeesByDepartment() {
    $.ajax({
        type: "GET",
        url: "@Url.Action("UpdateEmployeesByDepartment", "Employees")/" + Department.value,
    }).done(function (result) {
        $("#Employeestable").html(result);
        changeT();

    }).fail(function (e) { alert(e.responseText) });

}

        /////////////////WU//////////////////

        function OverTimeIndex() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Index", "OverTimeRequests")",
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);
        $('#basic-datatables').DataTable({
        });
        $("#basic-datatables_filter").hide();
        $('#Search').bind("click",
            function () {
                OTsearch();
            });

        SetTimePicker($("#StartTime"), $("#EndTime"));
    }).fail(function (e) { alert(e.responseText) });
        }

         function OTsearch() {
            let a = $("#StartTime").val()
            let st = a.split('-')
            let Start = st[0] + st[1] + st[2]
            let et = $("#EndTime").val().split('-')
            let End = et[0] + et[1] + et[2]
            $.ajax({

                type: "GET",
                url: "@Url.RouteUrl("Default1", new { controller = "OverTimeRequests", action = "Overtimetable" })/" + Start + "/" + End,
            }).done(function (result) {

                    $("#OverTimeTable").html(result);
                    $('#basic-datatables').DataTable({
                });
                $("#basic-datatables_filter").hide();
                }).fail(function(e){
                alert(e.responseText);
                });
        }


    function OverTimeCreate() {
    $.ajax({
    type: "GET",
    url: "@Url.Action("Create", "OverTimeRequests")",
    dataType: "html",
    }).done(function (result) {
        d = new Date();
        $("#aaaa").html(result);

        $('#addModal').modal('show');
        $("#StartTime_wu_creat").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "17" + ":" + "00");
        $("#EndTime_wu_creat").val(d.getFullYear() + "-" + zeroPadded(d.getMonth() + 1) + "-" + zeroPadded(d.getDate()) + "T" + "19" + ":" + "00");
        TimeErrorProof($("#StartTime_wu_creat"), $("#EndTime_wu_creat"));      

    }).fail(function (e) { alert(e.responseText) });
        }


      function CreateNewOT() {
    var data = new FormData();
          data.append("StartTime", StartTime.value);
          data.append("EndTime", EndTime.value);
          data.append("OverTimePay", OverTimePay.value);
          data.append("OverTimeReason", OverTimeReason.value);

    $.ajax({
        url: "@Url.Action("Create","OverTimeRequests")",
        type: "POST",
        contentType: false,         // 告诉jQuery不要去這置Content-Type
        processData: false,         // 告诉jQuery不要去處理發送的數據
        dataType: "json",
        data: data,

    }).done(function (result) {


        alert('已送出申請');
        OverTimeIndex();
        }).fail(function (e) {
            alert(e.responseJSON.Message);

        });
        }



        @*function opencalendar() {
            $('#addModal').modal('show');
            var calendarEl_open = document.getElementById('calendar_open');
            var calendar = new FullCalendar.Calendar(calendarEl_open, {
                plugins: ['dayGrid'],
                events: "@Url.Action("LoadCalender", "Home")",
                lazyFetching: false,
            });

            calendar.render();
        };*@


    function OverTimeDetails(requestid) {
    $.ajax({
    type: "GET",
        url: "@Url.Action("Details", "OverTimeRequests")",
        data: { "id": requestid},
    dataType: "html",
    }).done(function (result) {
        $("#mainpanel").html(result);

    }).fail(function (e) { alert(e.responseText) });
    }


        //Calendar
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: ['interaction', 'dayGrid', 'timeGrid'],
                defaultView: 'dayGridMonth',
                showNonCurrentDates: false,
                events: "@Url.Action("LoadCalender", "Home")",
                lazyFetching: false,
                locale: "zh-tw",
                droppable: true,
                editable: true,
            });
          
            calendar.render();
            //new Draggable(EventItem);
            //$('#fc-prev-button fc-button fc-button-primary').bind('click',)
            //////////////////////////////////////////////////

            @*var calendarEl_open = document.getElementById('calendar_open');
            var calendar_opne = new FullCalendar.Calendar(calendarEl_open, {
                plugins: ['dayGrid'],
                events: "@Url.Action("LoadCalender", "Home")",
                lazyFetching: false,
            });
            calendar_opne.render();*@





        });

        //$("#calendar").click(function () {
        //    $('#addModal').modal('show');

        //})





    </script>
}
